<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ec4899">
    <title>Lunarium - Planning Cyclique ðŸŒ¸</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background-color: #f9fafb;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px 24px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .cycle-day {
            cursor: pointer;
            transition: all 0.2s;
        }
        .cycle-day:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }
        .cycle-day.selected {
            filter: brightness(1.2);
            box-shadow: 0 0 0 3px white, 0 0 0 5px #ec4899;
        }
        .sync-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #e5e7eb;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .phase-legend {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 24px;
        }
        .phase-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .event-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 4px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // CONFIGURATION GOOGLE CALENDAR API
        const GOOGLE_CLIENT_ID = '711219272291-i1je9vqn1b4p0asn4fov7bdohoa08q38.apps.googleusercontent.com';
        const GOOGLE_API_KEY = 'AIzaSyA81G3xJq6iTJitDv6GO_rvjaOucTpeDNA';
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/calendar';

        // CONFIGURATION DES PHASES DU CYCLE
        const CYCLE_PHASES = {
            menstruation: {
                name: 'Lune Rouge',
                archetype: 'SorciÃ¨re',
                emoji: 'ðŸŒ‘',
                color: '#dc2626',
                lightColor: '#fecaca',
                description: 'Repos, introspection, prise de conscience',
                getDays: (cycleLength) => [1, 2, 3]
            },
            preOvulation: {
                name: 'Jeune Fille',
                archetype: 'Dynamique',
                emoji: 'ðŸŒ’',
                color: '#16a34a',
                lightColor: '#bbf7d0',
                description: 'Ã‰nergie, crÃ©ativitÃ©, nouveaux projets',
                getDays: (cycleLength) => {
                    const days = [];
                    for (let i = 4; i <= Math.floor(cycleLength / 2) - 3; i++) {
                        days.push(i);
                    }
                    return days;
                }
            },
            ovulation: {
                name: 'MÃ¨re',
                archetype: 'NourriciÃ¨re',
                emoji: 'ðŸŒ•',
                color: '#f59e0b',
                lightColor: '#fde68a',
                description: 'Ouverture, communication, collaboration',
                getDays: (cycleLength) => {
                    const ovulationDay = Math.floor(cycleLength / 2);
                    return [ovulationDay - 1, ovulationDay, ovulationDay + 1];
                }
            },
            preMenustruation: {
                name: 'Enchanteresse',
                archetype: 'Intuitive',
                emoji: 'ðŸŒ˜',
                color: '#8b5cf6',
                lightColor: '#ddd6fe',
                description: 'Intuition, finition, recentrage',
                getDays: (cycleLength) => {
                    const days = [];
                    const start = Math.floor(cycleLength / 2) + 2;
                    for (let i = start; i <= cycleLength; i++) {
                        days.push(i);
                    }
                    return days;
                }
            }
        };

        // ===== ICÃ”NES =====
        const GoogleIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24">
                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
        );

        const SyncIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
        );

        const SettingsIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m5.66-17a10 10 0 0 1 0 16M6.34 4a10 10 0 0 0 0 16"></path>
            </svg>
        );

        const XIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        // ===== GOOGLE CALENDAR SYNC COMPONENT =====
        const GoogleCalendarSync = ({ onSync, onError }) => {
            const [isSignedIn, setIsSignedIn] = useState(false);
            const [isSyncing, setIsSyncing] = useState(false);
            const [calendars, setCalendars] = useState([]);
            const [selectedCalendars, setSelectedCalendars] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const gapiInited = useRef(false);
            const gisInited = useRef(false);
            const tokenClient = useRef(null);

            useEffect(() => {
                let gapiTimeout, gisTimeout;
                
                const checkAndLoad = () => {
                    if (typeof gapi !== 'undefined') {
                        gapiLoaded();
                        clearTimeout(gapiTimeout);
                    } else {
                        gapiTimeout = setTimeout(checkAndLoad, 200);
                    }
                };
                
                const checkAndLoadGis = () => {
                    if (typeof google !== 'undefined' && google.accounts) {
                        gisLoaded();
                        clearTimeout(gisTimeout);
                    } else {
                        gisTimeout = setTimeout(checkAndLoadGis, 200);
                    }
                };
                
                setTimeout(() => {
                    checkAndLoad();
                    checkAndLoadGis();
                }, 500);
                
                setTimeout(() => {
                    if (!gapiInited.current || !gisInited.current) {
                        setIsLoading(false);
                        onError?.('Impossible de charger Google Calendar. Veuillez recharger la page.');
                    }
                }, 10000);
                
                return () => {
                    clearTimeout(gapiTimeout);
                    clearTimeout(gisTimeout);
                };
            }, []);

            const gapiLoaded = () => {
                if (typeof gapi !== 'undefined') {
                    gapi.load('client', initializeGapiClient);
                }
            };

            const initializeGapiClient = async () => {
                try {
                    await gapi.client.init({
                        apiKey: GOOGLE_API_KEY,
                        discoveryDocs: [DISCOVERY_DOC],
                    });
                    gapiInited.current = true;
                    maybeEnableButtons();
                } catch (err) {
                    console.error('Error initializing GAPI:', err);
                    onError?.('Erreur d\'initialisation Google API');
                }
            };

            const gisLoaded = () => {
                if (typeof google !== 'undefined') {
                    tokenClient.current = google.accounts.oauth2.initTokenClient({
                        client_id: GOOGLE_CLIENT_ID,
                        scope: SCOPES,
                        callback: async (response) => {
                            if (response.error) {
                                console.error('Auth error:', response.error);
                                onError?.('Erreur d\'authentification Google');
                                return;
                            }
                            setIsSignedIn(true);
                            await loadCalendars();
                        },
                    });
                    gisInited.current = true;
                    maybeEnableButtons();
                }
            };

            const maybeEnableButtons = () => {
                if (gapiInited.current && gisInited.current) {
                    setIsLoading(false);
                    if (gapi.client.getToken()) {
                        setIsSignedIn(true);
                        loadCalendars();
                    }
                }
            };

            const handleAuthClick = () => {
                if (!tokenClient.current) {
                    onError?.('Initialisation en cours, veuillez rÃ©essayer dans quelques secondes');
                    return;
                }
                
                if (typeof gapi === 'undefined' || !gapi.client) {
                    onError?.('Google API en cours de chargement, veuillez rÃ©essayer');
                    return;
                }
                
                if (gapi.client.getToken() === null) {
                    tokenClient.current.requestAccessToken({ prompt: 'consent' });
                } else {
                    tokenClient.current.requestAccessToken({ prompt: '' });
                }
            };

            const handleSignoutClick = () => {
                if (typeof gapi === 'undefined' || !gapi.client) return;
                
                const token = gapi.client.getToken();
                if (token !== null) {
                    google.accounts.oauth2.revoke(token.access_token);
                    gapi.client.setToken('');
                    setIsSignedIn(false);
                    setCalendars([]);
                    setSelectedCalendars([]);
                }
            };

            const loadCalendars = async () => {
                if (typeof gapi === 'undefined' || !gapi.client) return;
                
                try {
                    const response = await gapi.client.calendar.calendarList.list();
                    const cals = response.result.items || [];
                    setCalendars(cals);
                    
                    const primary = cals.find(cal => cal.primary);
                    if (primary) {
                        setSelectedCalendars([primary.id]);
                        localStorage.setItem('selectedCalendars', JSON.stringify([primary.id]));
                    }
                } catch (err) {
                    console.error('Error loading calendars:', err);
                    onError?.('Erreur de chargement des calendriers');
                }
            };

            const handleSync = async () => {
                if (!isSignedIn || selectedCalendars.length === 0) return;
                if (typeof gapi === 'undefined' || !gapi.client) {
                    onError?.('Google API non disponible');
                    return;
                }
                
                setIsSyncing(true);
                try {
                    const now = new Date();
                    const sixMonthsAgo = new Date(now.getFullYear(), now.getMonth() - 6, 1);
                    const sixMonthsAhead = new Date(now.getFullYear(), now.getMonth() + 6, 31);
                    
                    const allEvents = [];
                    for (const calendarId of selectedCalendars) {
                        const response = await gapi.client.calendar.events.list({
                            calendarId: calendarId,
                            timeMin: sixMonthsAgo.toISOString(),
                            timeMax: sixMonthsAhead.toISOString(),
                            singleEvents: true,
                            orderBy: 'startTime',
                        });
                        
                        const events = response.result.items || [];
                        allEvents.push(...events.map(e => ({ ...e, calendarId })));
                    }
                    
                    onSync?.(allEvents, selectedCalendars[0]);
                } catch (err) {
                    console.error('Error syncing:', err);
                    onError?.('Erreur de synchronisation');
                } finally {
                    setIsSyncing(false);
                }
            };

            const toggleCalendar = (calendarId) => {
                const newSelected = selectedCalendars.includes(calendarId)
                    ? selectedCalendars.filter(id => id !== calendarId)
                    : [...selectedCalendars, calendarId];
                
                setSelectedCalendars(newSelected);
                localStorage.setItem('selectedCalendars', JSON.stringify(newSelected));
            };

            return (
                <div style={{ padding: '20px', background: 'white', borderRadius: '12px', marginBottom: '20px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '16px' }}>
                        <h3 style={{ margin: 0, fontSize: '16px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '8px' }}>
                            <GoogleIcon />
                            Google Calendar
                        </h3>
                        {!isSignedIn ? (
                            <button
                                onClick={handleAuthClick}
                                disabled={isLoading}
                                style={{
                                    padding: '8px 16px',
                                    backgroundColor: isLoading ? '#9ca3af' : '#4285F4',
                                    color: 'white',
                                    borderRadius: '8px',
                                    fontWeight: '500',
                                    cursor: isLoading ? 'not-allowed' : 'pointer',
                                    border: 'none',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px',
                                    fontSize: '14px'
                                }}
                            >
                                <GoogleIcon />
                                {isLoading ? 'Chargement...' : 'Se connecter'}
                            </button>
                        ) : (
                            <div style={{ display: 'flex', gap: '8px' }}>
                                <button
                                    onClick={handleSync}
                                    disabled={isSyncing || selectedCalendars.length === 0}
                                    style={{
                                        padding: '8px 16px',
                                        backgroundColor: isSyncing ? '#9ca3af' : '#16a34a',
                                        color: 'white',
                                        borderRadius: '8px',
                                        fontWeight: '500',
                                        cursor: isSyncing ? 'not-allowed' : 'pointer',
                                        border: 'none',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '8px',
                                        fontSize: '14px'
                                    }}
                                >
                                    <SyncIcon />
                                    {isSyncing ? 'Synchronisation...' : 'Synchroniser'}
                                </button>
                                <button
                                    onClick={handleSignoutClick}
                                    style={{
                                        padding: '8px 16px',
                                        backgroundColor: '#ef4444',
                                        color: 'white',
                                        borderRadius: '8px',
                                        fontWeight: '500',
                                        cursor: 'pointer',
                                        border: 'none',
                                        fontSize: '14px'
                                    }}
                                >
                                    DÃ©connecter
                                </button>
                            </div>
                        )}
                    </div>

                    {isSignedIn && calendars.length > 0 && (
                        <div>
                            <p style={{ fontSize: '13px', color: '#6b7280', marginBottom: '12px' }}>
                                Calendriers synchronisÃ©s :
                            </p>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                {calendars.map(cal => (
                                    <label
                                        key={cal.id}
                                        style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '8px',
                                            padding: '8px',
                                            borderRadius: '6px',
                                            cursor: 'pointer',
                                            background: selectedCalendars.includes(cal.id) ? '#f0fdf4' : 'transparent'
                                        }}
                                    >
                                        <input
                                            type="checkbox"
                                            checked={selectedCalendars.includes(cal.id)}
                                            onChange={() => toggleCalendar(cal.id)}
                                            style={{ cursor: 'pointer' }}
                                        />
                                        <div
                                            style={{
                                                width: '12px',
                                                height: '12px',
                                                borderRadius: '50%',
                                                backgroundColor: cal.backgroundColor || '#3b82f6'
                                            }}
                                        />
                                        <span style={{ fontSize: '14px' }}>
                                            {cal.summary} {cal.primary && '(Principal)'}
                                        </span>
                                    </label>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ===== CONFIGURATION MODAL =====
        const ConfigModal = ({ config, onSave, onClose }) => {
            const [startDate, setStartDate] = useState(config.startDate);
            const [cycleLength, setCycleLength] = useState(config.cycleLength);

            return (
                <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    backgroundColor: 'rgba(0,0,0,0.5)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000
                }}>
                    <div style={{
                        backgroundColor: 'white',
                        borderRadius: '12px',
                        padding: '24px',
                        maxWidth: '500px',
                        width: '90%',
                        boxShadow: '0 20px 25px -5px rgba(0,0,0,0.1)'
                    }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' }}>
                            <h2 style={{ margin: 0, fontSize: '20px', fontWeight: '600' }}>Configuration du cycle</h2>
                            <button onClick={onClose} style={{ cursor: 'pointer', border: 'none', background: 'none' }}>
                                <XIcon />
                            </button>
                        </div>

                        <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: '500' }}>
                                Premier jour des derniÃ¨res rÃ¨gles
                            </label>
                            <input
                                type="date"
                                value={startDate}
                                onChange={(e) => setStartDate(e.target.value)}
                                style={{
                                    width: '100%',
                                    padding: '10px',
                                    borderRadius: '8px',
                                    border: '1px solid #e5e7eb',
                                    fontSize: '14px'
                                }}
                            />
                        </div>

                        <div style={{ marginBottom: '24px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: '500' }}>
                                DurÃ©e du cycle (jours)
                            </label>
                            <input
                                type="number"
                                min="21"
                                max="35"
                                value={cycleLength}
                                onChange={(e) => setCycleLength(parseInt(e.target.value))}
                                style={{
                                    width: '100%',
                                    padding: '10px',
                                    borderRadius: '8px',
                                    border: '1px solid #e5e7eb',
                                    fontSize: '14px'
                                }}
                            />
                        </div>

                        <div style={{ display: 'flex', gap: '12px', justifyContent: 'flex-end' }}>
                            <button
                                onClick={onClose}
                                style={{
                                    padding: '10px 20px',
                                    borderRadius: '8px',
                                    border: '1px solid #e5e7eb',
                                    background: 'white',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    fontWeight: '500'
                                }}
                            >
                                Annuler
                            </button>
                            <button
                                onClick={() => onSave({ startDate, cycleLength })}
                                style={{
                                    padding: '10px 20px',
                                    borderRadius: '8px',
                                    border: 'none',
                                    background: '#ec4899',
                                    color: 'white',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    fontWeight: '500'
                                }}
                            >
                                Enregistrer
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // ===== COMPOSANT PRINCIPAL =====
        function LunariumPlanner() {
            const [events, setEvents] = useState({});
            const [toast, setToast] = useState(null);
            const [showConfigModal, setShowConfigModal] = useState(false);
            const [selectedDay, setSelectedDay] = useState(null);
            const [primaryCalendarId, setPrimaryCalendarId] = useState(null);

            const [cycleConfig, setCycleConfig] = useState(() => {
                const saved = localStorage.getItem('cycleConfig');
                return saved ? JSON.parse(saved) : {
                    startDate: new Date().toISOString().split('T')[0],
                    cycleLength: 28
                };
            });

            useEffect(() => {
                localStorage.setItem('cycleConfig', JSON.stringify(cycleConfig));
            }, [cycleConfig]);

            const syncFromGoogleCalendar = (googleEvents, primaryCal) => {
                setPrimaryCalendarId(primaryCal);
                
                const newEvents = {};
                googleEvents.forEach(event => {
                    if (!event.start || !event.start.dateTime) return;
                    
                    const dateKey = event.start.dateTime.split('T')[0];
                    if (!newEvents[dateKey]) {
                        newEvents[dateKey] = [];
                    }
                    
                    newEvents[dateKey].push({
                        id: event.id,
                        title: event.summary || 'Sans titre',
                        description: event.description || '',
                        start: event.start.dateTime,
                        end: event.end.dateTime,
                        color: event.colorId ? getGoogleColor(event.colorId) : '#3b82f6'
                    });
                });
                
                setEvents(newEvents);
                showToast('Synchronisation rÃ©ussie âœ“', 'success');
            };

            const getGoogleColor = (colorId) => {
                const colors = {
                    '1': '#7986cb', '2': '#33b679', '3': '#8e24aa', '4': '#e67c73',
                    '5': '#f6c026', '6': '#f5511d', '7': '#039be5', '8': '#616161',
                    '9': '#3f51b5', '10': '#0b8043', '11': '#d60000'
                };
                return colors[colorId] || '#3b82f6';
            };

            const showToast = (message, type = 'info') => {
                setToast({ message, type });
                setTimeout(() => setToast(null), 3000);
            };

            const getCycleDay = (date) => {
                const start = new Date(cycleConfig.startDate);
                const current = new Date(date);
                const diffTime = current - start;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                return ((diffDays % cycleConfig.cycleLength) + cycleConfig.cycleLength) % cycleConfig.cycleLength + 1;
            };

            const getPhaseForDay = (cycleDay) => {
                for (const [key, phase] of Object.entries(CYCLE_PHASES)) {
                    const days = phase.getDays(cycleConfig.cycleLength);
                    if (days.includes(cycleDay)) {
                        return { key, ...phase };
                    }
                }
                return null;
            };

            const getCycleDayDate = (cycleDay) => {
                const start = new Date(cycleConfig.startDate);
                start.setDate(start.getDate() + cycleDay - 1);
                return start.toISOString().split('T')[0];
            };

            const getEventsForCycleDay = (cycleDay) => {
                const dateKey = getCycleDayDate(cycleDay);
                return events[dateKey] || [];
            };

            const renderCycleView = () => {
                const centerX = 300;
                const centerY = 300;
                const outerRadius = 240;
                const innerRadius = 120;

                return (
                    <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
                        <div style={{ display: 'flex', gap: '24px', alignItems: 'flex-start' }}>
                            {/* Cercle du cycle */}
                            <div style={{ flex: '1', display: 'flex', justifyContent: 'center' }}>
                                <svg width="600" height="600" viewBox="0 0 600 600">
                                    {/* Fond blanc */}
                                    <circle cx={centerX} cy={centerY} r={outerRadius} fill="white" />
                                    
                                    {/* Segments de phases */}
                                    {Object.entries(CYCLE_PHASES).map(([key, phase]) => {
                                        const days = phase.getDays(cycleConfig.cycleLength);
                                        const startDay = days[0];
                                        const endDay = days[days.length - 1];
                                        
                                        const startAngle = ((startDay - 1) / cycleConfig.cycleLength) * 360 - 90;
                                        const endAngle = (endDay / cycleConfig.cycleLength) * 360 - 90;
                                        
                                        const startRad = (startAngle * Math.PI) / 180;
                                        const endRad = (endAngle * Math.PI) / 180;
                                        
                                        const x1 = centerX + innerRadius * Math.cos(startRad);
                                        const y1 = centerY + innerRadius * Math.sin(startRad);
                                        const x2 = centerX + outerRadius * Math.cos(startRad);
                                        const y2 = centerY + outerRadius * Math.sin(startRad);
                                        const x3 = centerX + outerRadius * Math.cos(endRad);
                                        const y3 = centerY + outerRadius * Math.sin(endRad);
                                        const x4 = centerX + innerRadius * Math.cos(endRad);
                                        const y4 = centerY + innerRadius * Math.sin(endRad);
                                        
                                        const largeArc = (endAngle - startAngle) > 180 ? 1 : 0;
                                        
                                        return (
                                            <path
                                                key={key}
                                                d={`M ${x1} ${y1} L ${x2} ${y2} A ${outerRadius} ${outerRadius} 0 ${largeArc} 1 ${x3} ${y3} L ${x4} ${y4} A ${innerRadius} ${innerRadius} 0 ${largeArc} 0 ${x1} ${y1} Z`}
                                                fill={phase.lightColor}
                                                stroke={phase.color}
                                                strokeWidth="2"
                                            />
                                        );
                                    })}
                                    
                                    {/* Jours du cycle */}
                                    {Array.from({ length: cycleConfig.cycleLength }, (_, i) => {
                                        const day = i + 1;
                                        const angle = (day / cycleConfig.cycleLength) * 360 - 90;
                                        const rad = (angle * Math.PI) / 180;
                                        const radius = (innerRadius + outerRadius) / 2;
                                        const x = centerX + radius * Math.cos(rad);
                                        const y = centerY + radius * Math.sin(rad);
                                        
                                        const phase = getPhaseForDay(day);
                                        const dayEvents = getEventsForCycleDay(day);
                                        const today = new Date().toISOString().split('T')[0];
                                        const isToday = getCycleDayDate(day) === today;
                                        
                                        return (
                                            <g key={day}>
                                                <circle
                                                    cx={x}
                                                    cy={y}
                                                    r={isToday ? 20 : 16}
                                                    fill={isToday ? phase?.color : 'white'}
                                                    stroke={phase?.color}
                                                    strokeWidth={isToday ? 3 : 2}
                                                    className="cycle-day"
                                                    onClick={() => setSelectedDay(day)}
                                                    style={{ cursor: 'pointer' }}
                                                />
                                                <text
                                                    x={x}
                                                    y={y + 5}
                                                    textAnchor="middle"
                                                    fontSize="12"
                                                    fontWeight={isToday ? "bold" : "normal"}
                                                    fill={isToday ? 'white' : '#374151'}
                                                >
                                                    {day}
                                                </text>
                                                {dayEvents.length > 0 && (
                                                    <circle cx={x + 12} cy={y - 12} r="4" fill={phase?.color} />
                                                )}
                                            </g>
                                        );
                                    })}
                                    
                                    {/* Centre avec emoji */}
                                    <text x={centerX} y={centerY} textAnchor="middle" fontSize="60">
                                        ðŸŒ¸
                                    </text>
                                </svg>
                            </div>

                            {/* DÃ©tails du jour sÃ©lectionnÃ© */}
                            {selectedDay && (
                                <div style={{
                                    width: '350px',
                                    background: 'white',
                                    borderRadius: '12px',
                                    padding: '20px',
                                    boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
                                }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
                                        <h3 style={{ margin: 0, fontSize: '18px', fontWeight: '600' }}>
                                            Jour {selectedDay}
                                        </h3>
                                        <button
                                            onClick={() => setSelectedDay(null)}
                                            style={{
                                                cursor: 'pointer',
                                                border: 'none',
                                                background: 'none',
                                                padding: '4px'
                                            }}
                                        >
                                            <XIcon />
                                        </button>
                                    </div>

                                    {(() => {
                                        const phase = getPhaseForDay(selectedDay);
                                        const date = new Date(getCycleDayDate(selectedDay));
                                        const dayEvents = getEventsForCycleDay(selectedDay);
                                        
                                        return (
                                            <>
                                                <div style={{
                                                    padding: '12px',
                                                    borderRadius: '8px',
                                                    background: phase?.lightColor,
                                                    marginBottom: '16px'
                                                }}>
                                                    <div style={{ fontSize: '24px', marginBottom: '8px' }}>
                                                        {phase?.emoji}
                                                    </div>
                                                    <div style={{ fontWeight: '600', marginBottom: '4px' }}>
                                                        {phase?.name} - {phase?.archetype}
                                                    </div>
                                                    <div style={{ fontSize: '13px', color: '#6b7280' }}>
                                                        {phase?.description}
                                                    </div>
                                                </div>

                                                <div style={{ marginBottom: '16px' }}>
                                                    <div style={{ fontSize: '14px', color: '#6b7280', marginBottom: '8px' }}>
                                                        {date.toLocaleDateString('fr-FR', {
                                                            weekday: 'long',
                                                            day: 'numeric',
                                                            month: 'long'
                                                        })}
                                                    </div>
                                                </div>

                                                {dayEvents.length > 0 ? (
                                                    <div>
                                                        <h4 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '12px' }}>
                                                            Ã‰vÃ©nements ({dayEvents.length})
                                                        </h4>
                                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                                            {dayEvents.map((event, idx) => (
                                                                <div
                                                                    key={idx}
                                                                    style={{
                                                                        padding: '10px',
                                                                        borderRadius: '8px',
                                                                        borderLeft: `4px solid ${event.color}`,
                                                                        background: '#f9fafb',
                                                                        fontSize: '13px'
                                                                    }}
                                                                >
                                                                    <div style={{ fontWeight: '500', marginBottom: '4px' }}>
                                                                        {event.title}
                                                                    </div>
                                                                    <div style={{ fontSize: '12px', color: '#6b7280' }}>
                                                                        {new Date(event.start).toLocaleTimeString('fr-FR', {
                                                                            hour: '2-digit',
                                                                            minute: '2-digit'
                                                                        })}
                                                                        {' - '}
                                                                        {new Date(event.end).toLocaleTimeString('fr-FR', {
                                                                            hour: '2-digit',
                                                                            minute: '2-digit'
                                                                        })}
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div style={{ textAlign: 'center', padding: '20px', color: '#9ca3af', fontSize: '14px' }}>
                                                        Aucun Ã©vÃ©nement ce jour
                                                    </div>
                                                )}
                                            </>
                                        );
                                    })()}
                                </div>
                            )}
                        </div>

                        {/* LÃ©gende des phases */}
                        <div className="phase-legend" style={{ justifyContent: 'center', marginTop: '32px' }}>
                            {Object.entries(CYCLE_PHASES).map(([key, phase]) => (
                                <div key={key} className="phase-badge">
                                    <span style={{ fontSize: '20px' }}>{phase.emoji}</span>
                                    <div>
                                        <div style={{ fontWeight: '600', fontSize: '14px' }}>
                                            {phase.name}
                                        </div>
                                        <div style={{ fontSize: '12px', color: '#6b7280' }}>
                                            {phase.archetype}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            const Toast = ({ message, type }) => {
                const colors = {
                    success: '#16a34a',
                    error: '#ef4444',
                    info: '#3b82f6'
                };

                return (
                    <div className="toast" style={{ borderLeft: `4px solid ${colors[type]}` }}>
                        <span style={{ fontSize: '14px', fontWeight: '500' }}>{message}</span>
                    </div>
                );
            };

            return (
                <div style={{ minHeight: '100vh', backgroundColor: '#f9fafb' }}>
                    {/* Header */}
                    <div style={{
                        backgroundColor: 'white',
                        borderBottom: '1px solid #e5e7eb',
                        padding: '16px 24px',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center'
                    }}>
                        <h1 style={{
                            margin: 0,
                            fontSize: '24px',
                            fontWeight: '700',
                            background: 'linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%)',
                            WebkitBackgroundClip: 'text',
                            WebkitTextFillColor: 'transparent'
                        }}>
                            Lunarium ðŸŒ¸
                        </h1>

                        <button
                            onClick={() => setShowConfigModal(true)}
                            style={{
                                padding: '8px 12px',
                                backgroundColor: 'white',
                                color: '#6b7280',
                                borderRadius: '8px',
                                cursor: 'pointer',
                                border: '1px solid #e5e7eb',
                                display: 'flex',
                                alignItems: 'center',
                                gap: '8px',
                                fontSize: '14px',
                                fontWeight: '500'
                            }}
                        >
                            <SettingsIcon />
                            Configuration
                        </button>
                    </div>

                    {/* Contenu */}
                    <div style={{ padding: '24px' }}>
                        <GoogleCalendarSync
                            onSync={syncFromGoogleCalendar}
                            onError={(msg) => showToast(msg, 'error')}
                        />

                        <div style={{
                            background: 'white',
                            borderRadius: '12px',
                            padding: '32px',
                            boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
                        }}>
                            <h2 style={{ marginTop: 0, marginBottom: '24px', fontSize: '20px', fontWeight: '600', textAlign: 'center' }}>
                                Mon Cycle ðŸŒ™
                            </h2>
                            {renderCycleView()}
                        </div>
                    </div>

                    {/* Modals */}
                    {showConfigModal && (
                        <ConfigModal
                            config={cycleConfig}
                            onSave={(newConfig) => {
                                setCycleConfig(newConfig);
                                setShowConfigModal(false);
                                showToast('Configuration enregistrÃ©e', 'success');
                            }}
                            onClose={() => setShowConfigModal(false)}
                        />
                    )}

                    {/* Toast */}
                    {toast && <Toast message={toast.message} type={toast.type} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LunariumPlanner />);
    </script>
</body>
</html>
